name: Update age in profile README
on:
  schedule:
    # 7 September, 03:00 UTC (1x per jaar)
    - cron: "0 3 7 9 *"
  workflow_dispatch:
permissions:
  contents: write
jobs:
  update-age:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Compute age
        id: age
        run: |
          BIRTHDATE="1998-09-06"
          TODAY="$(date -u +%F)"
          BY="$(date -u -d "$BIRTHDATE" +%Y)"
          BM="$(date -u -d "$BIRTHDATE" +%m)"
          BD="$(date -u -d "$BIRTHDATE" +%d)"
          TY="$(date -u -d "$TODAY" +%Y)"
          TM="$(date -u -d "$TODAY" +%m)"
          TD="$(date -u -d "$TODAY" +%d)"
          AGE=$((TY - BY))
          if [[ "$TM$TD" < "$BM$BD" ]]; then AGE=$((AGE - 1)); fi
          echo "age=$AGE" >> "$GITHUB_OUTPUT"
      - name: Update README marker value
        run: |
          AGE="${{ steps.age.outputs.age }}"
          # Fail fast if markers don't exist (clear error)
          if ! grep -q "<!-- AGE_START -->" README.md || ! grep -q "<!-- AGE_END -->" README.md; then
            echo "Markers not found. Put this in README.md:"
            echo "ðŸ‘¤ Age: <!-- AGE_START -->26<!-- AGE_END -->"
            exit 1
          fi
          # Replace ONLY the number between the markers on the same line
          # Example: <!-- AGE_START -->26<!-- AGE_END --> -> <!-- AGE_START -->27<!-- AGE_END -->
          sed -i -E "s/(<!-- AGE_START -->)[0-9]+(<!-- AGE_END -->)/\1${AGE}\2/g" README.md
      - name: Commit & push if changed
        run: |
          if git diff --quiet; then
            echo "No changes."
            exit 0
          fi
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "chore: update age"
          git push
